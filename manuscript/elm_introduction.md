# Знакомство с Elm

Мы собираемся разработать фронтенд для нашего приложения, используя язык Elm. Для этого потребуется использовать данные из уже реализованного бэкенд-приложения на Phoenix и преобразовать их в  фронтенд-приложение на Elm. Далее мы также будем использовать Elm для создания мини-игр для нашей платформы. Но прежде чем мы перейдем ко всему этому, давайте кратко рассмотрим, что такое Elm, как он работает и почему нам всё-же нужно его использовать.

## Введение

Поначалу Elm может выглядеть и казаться себя немного чужим. Но не позволяйте этому чувству спугнуть вас, потому что это _очень_ мощный язык, с которым _очень_ приятно работать.

Дизайн Elm предлагает то, что многие другие языки просто не могут. Данный язык позволяет разработчикам писать код, не подверженный ошибкам, который легче рефакторить и поддерживать.

Я мог бы месяцами рассказывать о том, какой хороший Elm (и я сделал это на локальном митапе по Elm), но давайте разберем несколько простых примеров.

## Hello.elm

Мы можем начать с классического примера «Hello World», чтобы продемонстрировать, как легко начать работать с Elm. Вот как выглядит самая простая программа на Elm (с именем файла `Hello.elm`):

```elm
module Hello exposing (main)

import Html


main =
    Html.text "Hello World"
```

Синтаксис лаконичен, позволяющий быстро отобразить текст на странице в браузере (мы вернемся к этому через секунду). Но это также хороший пример, поскольку показывает несколько особенностей Elm, которые на первый взгляд могут сбить с толку. Так, например, где все круглые и фигурные скобки? Что это за странный отступ?

## Синтаксис Elm

Первая строка — это шаблонный код для определения модуля. Поскольку Elm это функциональный язык, то все, с чем мы работаем, представляет собой модули и функции. Функции будут служить для нас _всем_, когда как модули помогут нам собрать и организовать все эти функции. Итак, в первой строке кода мы создаем модуль `Hello` и «раскрываем» единственную функцию (`main`) в нем. Поэтому, если кто-то захочет использовать ваш модуль, ему нужно всего лишь импортировать его, и тогда он сможет использовать любую функциональность, предоставляемую данной функцией `main`.

## Модули, функции и типы

Кстати про импортирование — в следующей строке есть `import Html`. Эта строчка кода позволяет нам использовать любую функцию из встроенной [HTML-библиотеки](http://package.elm-lang.org/packages/elm-lang/html/latest/Html), поставляемой вместе с Elm.

Используемая функция в программе — это функция [`Html.text`](http://package.elm-lang.org/packages/elm-lang/html/latest/Html#text), которая принимает в качестве аргумента единственную строку. Если посмотреть на документацию к функции `text`, то можно увидеть синтаксис типа Elm:

```elm
text : String -> Html msg
```

Это означает, что когда мы добавили строчку кода `Html.text "Hello World"`, строка `"Hello World"` является единственным аргументом. В то время как строка `Html msg` является возвращаемым типом. В данный момент пока еще беспокойтесь относительно типизации, однако полезно подумать над несколькими короткими вопросами:

- Сколько аргументов принимает функция?
- Какой тип у каждого аргумента?
- Какой тип возвращаемого значения?

В нашем случае `text` — это имя функции. Затем мы используем символ `:` перед списком аргументов. Эта функция принимает только один аргумент типа `String`. Далее мы используем символ стрелки `->` после аргумента. Наконец, мы указываем тип возвращаемого значения `Html msg`. Часть `msg` не важна, и вместо этого могло быть, например, `Html a`. Самое главное, что мы возвращаем некоторый HTML-код, который мы собираемся использовать для отображения текста на странице в браузере.

## Основная функция

Функция `main` — отправная точка нашего приложения. Когда мы его запустим, среда выполнения кода Elm будет искать `main`. Но Elm _гораздо_ интереснее пробовать самому, чем читать про него, так что давайте наконец-то запустим пример.

Прежде чем мы сможем выполним код Elm, нужно установить собственно сам Elm. Существуют разные способы, но самый простой — использовать `npm`, поскольку у многих веб-разработчиков уже установлен [Node.js](https://nodejs.org/en). Кроме того, на [главной странице Elm](http://elm-lang.org) есть также установщики.

```shell
$ npm install -g elm
```

Этого должно быть достаточно. Данная команда глобально установит утилиту командной строки `elm` на компьютер. По факту, если ввести сейчас `elm`, можно увидеть следующий вывод (некоторые данные были сокращены в целях удобства чтения):

```shell
$ elm
Hi, thank you for trying out Elm 0.19.0. I hope you like it!

The most common commands are:

    elm repl
        Open up an interactive programming session. Type in Elm expressions like
        (2 + 2) or (String.length "test") and see if they equal four!

    elm init
        Start an Elm project. It creates a starter elm.json file and provides a
        link explaining what to do from there.

    elm reactor
        Compile code with a click. It opens a file viewer in your browser, and
        when you click on an Elm file, it compiles and you see the result.

...

Be sure to ask on the Elm slack if you run into trouble! Folks are friendly and
happy to help out. They hang out there because it is fun, so be kind to get the
best results!
```

В конечном итоге мы будем использовать некоторые из представленных выше возможностей командной строки, но пока давайте сосредоточимся на двух из них. Сначала создадим временную директорию `elm`, которую мы будем использовать для хранения наших Elm-файлов, а затем мы воспользуемся командой `elm init` для загрузки нужных библиотек. Также обратите внимание, что не обязательно помещать эту директорию в наше существующее приложение Phoenix, поскольку мы займемся интеграцией Phoenix и Elm в следующей главе.

```shell
$ mkdir elm
$ cd elm
$ elm init
```

Мы создаем пустую директорию `elm`, а затем при выполнении `elm init` будет создан файл `elm.json` (обратите внимание, что снова вывод команды был немного обрезан для удобства чтения):

```shell
$ elm init
Hello! Elm projects always start with an elm.json file. I can create them!

...

Would you like me to create an elm.json file now? [Y/n]: Y
Okay, I created it. Now read that link!
```

Вы могли заметить, насколько дружелюбен компилятор Elm. Вывод имеет разговорный тон, который может помочь как начинающим, так и опытным разработчикам. Можете почитать [соответствующий раздел в документации](https://elm-lang.org/0.19.0/init), упомянутый в выводе, чтобы получить дополнительную информацию по настройке Elm-проектов.

Сейчас у нас есть все, что нам нужно: файл `elm.json` для конфигурации проекта и папка `src` для хранения файлов с расширением `.elm`. Давайте создадим простой файл `Hello.elm` внутри директории `src` для нашей программы «Hello World»:


```elm
module Hello exposing (main)

import Html


main =
    Html.text "Hello World"
```

Осталось только запустить программу. Вместе с Elm входит утилита `elm reactor`, которую мы можем использовать для локального запуска нашей программы и последующего доступа к ней в браузере. Идем дальше и выполняем из командной строки:

```shell
$ elm reactor
Go to <http://localhost:8000> to see your project dashboard.
```

Теперь можно посетить `http://localhost:8000` в браузере и увидеть файлы и зависимости проекта.

![elm reactor](images/elm_introduction/elm_reactor.png)

У нас имеется только один Elm-файл (`Hello.elm`), поэтому давайте перейдем по ссылке в директорию `src`, чтобы скомпилировать его и посмотреть результаты.

![Elm Hello World Example](images/elm_introduction/elm_hello_world.png)

## elm-format

Разумеется, «Hello World» — это не самый интересный пример. Однако уже хорошо, что уже установлен Elm, а также есть хоть простая, но рабочая программа.

Давайте рассмотрим еще пару деталей, которые сделают нашу жизнь проще, имея в виду данный пример.

Прежде чем двигаться дальше, обязательно стоит попробовать [`elm-format`](https://github.com/avh4/elm-format). Это плагин, который значительно облегчает работу с Elm, можно использовать вместе с вашим редактором. Это особенно актуально, когда вы только начинаете, потому что вы можете получить общее представление о том, что вы хотите сделать, а также сразу узнать, является ли написанный вами код корректным, пока `elm-format` переформатирует код без отображения ошибки или предупреждения.

Хотя `elm-format` не является строго обязательным, и без него можно писать хороший код Elm, тем не менее это удивительно полезный инструмент, который поможет вам сосредоточиться на решении проблем, вместо того, чтобы думать о правильном синтаксисе.

## Комментарии и сигнатуры типов

Давай пойдем дальше и добавим сверху небольшой комментарий с помощью синтаксиса `-- comment`, который указывающий на имя файла:

```elm
-- Hello.elm
module Hello exposing (main)

import Html


main =
    Html.text "Hello World"
```

Далее, давайте немного улучшим объявление `import` для более четкого определения, какие функции мы хотим импортировать из модуля `Html`:

```elm
-- Hello.elm
module Hello exposing (main)

import Html exposing (Html, text)


main =
    text "Hello World"
```

Мы также можем добавить сигнатуру типа для функции `main`:

```elm
-- Hello.elm
module Hello exposing (main)

import Html exposing (Html, text)


main : Html msg
main =
    text "Hello World"
```

При создании сигнатуры типов, мы сначала перезагружаем имя функции. Затем, после символа `:`, указываем типы аргументов и возвращаемое значение. Но так как у этой функции нет аргументов, мы просто указываем в данном случае тип возвращаемого значения, которым является `Html msg`. Это значение просто означает, что мы возвращаем некоторый HTML-код из используемой нами функции `Html.text`.

Оператор конвейера, который мы узнали в Elixir, также есть в Elm. Фактически, мы можем переписать текст «Hello World» прописными буквами следующим образом:

```elm
-- Hello.elm
module Hello exposing (main)

import Html exposing (Html, text)


main : Html msg
main =
    "Hello World"
        |> String.toUpper
        |> text
```

Внутри функции `main` мы начинаем с простой строки `"Hello World"`. Затем передаем эту строку функции [`toUpper`](http://package.elm-lang.org/packages/elm-lang/core/latest/String#toUpper) из модуля [`String`](http://package.elm-lang.org/packages/elm-lang/core/latest/String). А потом передаем полученный результат в функцию `text`, возвращающее значение типа `Html msg`, которое определенное в нашей функции.

После просмотра результатов в браузере, можете удалить временную директорию `elm`, которую мы создали в начале главы, поскольку мы приведем в порядок наше Phoenix-приложение в следующей главе.

## Резюме

Есть еще много чего в Elm, чем то, что мы рассмотрели в нашем примере «Hello World». Однако это хорошее начало, чтобы посмотреть на синтаксис и увидеть, что он не такой страшный, как может показаться на первый взгляд. В следующих разделах мы настроим наше Phoenix-приложение для использования с Elm, который будем использовать в качестве фронтенда. Мы также поговорим об архитектуре Elm и о том, как получать данные из API в фронтенд-приложение.
